{"Timestamp":"2023-09-19T16:15:52.8726046+02:00","Level":"Error","MessageTemplate":"Failed executing DbCommand ({elapsed}ms) [Parameters=[{parameters}], CommandType='{commandType}', CommandTimeout='{commandTimeout}']{newLine}{commandText}","Properties":{"elapsed":"30","parameters":"","commandType":"Text","commandTimeout":30,"newLine":"\r\n","commandText":"DECLARE @UserId          UNIQUEIDENTIFIER\r\nDECLARE @OpinionsPerBeer INT\r\n\r\n-- Number of opinions generating for beer\r\nSET @OpinionsPerBeer = 20\r\n\r\n-- Select Id for \"user@localhost\" user\r\nSELECT @UserId = Id\r\nFROM AspNetUsers\r\nWHERE Username = 'user@localhost'\r\n\r\n-- Generate @OpinionsPerBeer opinions for each beer\r\nINSERT INTO Opinions (Id, Rating, Comment, BeerId, Created, CreatedBy, LastModified, LastModifiedBy)\r\nSELECT NEWID(),\r\n       FLOOR(RAND(CHECKSUM(NEWID())) * 10) + 1,\r\n       'Sample comment',\r\n       Beers.Id,\r\n       CreatedDate,\r\n       @UserId,\r\n       CreatedDate,\r\n       @UserId\r\nFROM Beers\r\n         CROSS JOIN (SELECT TOP (@OpinionsPerBeer) DATEADD(DAY, ABS(CHECKSUM(NEWID())) %\r\n                                                                (DATEDIFF(DAY, '2020-01-01', '2023-12-31') + 1),\r\n                                                           '2020-01-01') AS CreatedDate\r\n                     FROM sys.all_columns) AS BeerOpinions\r\nORDER BY Beers.Id\r\n\r\n-- Update beers ratings\r\nUPDATE Beers\r\nSET Rating = ISNULL(Opinions.AverageRating, 0)\r\nFROM Beers\r\n         LEFT JOIN (SELECT BeerId, ROUND(AVG(CAST(Rating AS FLOAT)), 2) AS AverageRating\r\n                    FROM Opinions\r\n                    GROUP BY BeerId) AS Opinions ON Beers.Id = Opinions.BeerId","EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:15:52.8996819+02:00","Level":"Error","MessageTemplate":"Seeding {TableName} failed","Properties":{"TableName":"Opinions","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:15:52.9009214+02:00","Level":"Error","MessageTemplate":"An error occurred while seeding the database. {E}","Properties":{"E":"Cannot insert the value NULL into column 'CreatedBy', table 'HoppyHub.dbo.Opinions'; column does not allow nulls. INSERT fails.\r\nThe statement has been terminated.","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:15:52.9058746+02:00","Level":"Fatal","MessageTemplate":"Hoppy Hub terminated unexpectedly","Exception":"Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CreatedBy', table 'HoppyHub.dbo.Opinions'; column does not allow nulls. INSERT fails.\r\nThe statement has been terminated.\r\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\r\n   at Microsoft.Data.SqlClient.SqlCommand.InternalEndExecuteNonQuery(IAsyncResult asyncResult, Boolean isInternal, String endMethod)\r\n   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryInternal(IAsyncResult asyncResult)\r\n   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryAsync(IAsyncResult asyncResult)\r\n   at System.Threading.Tasks.TaskFactory`1.FromAsyncCoreLogic(IAsyncResult iar, Func`2 endFunction, Action`1 endAction, Task`1 promise, Boolean requiresSynchronization)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedDatabaseFromSql(String tableName) in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 155\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedOpinionsAsync() in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 120\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedAsync() in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 60\r\n   at Program.<Main>$(String[] args) in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Api\\Program.cs:line 57\r\nClientConnectionId:2a5a434f-cfb5-4f73-a3d3-45b7ad3b61b3\r\nError Number:515,State:2,Class:16","Properties":{"ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:18:09.1842870+02:00","Level":"Error","MessageTemplate":"Failed executing DbCommand ({elapsed}ms) [Parameters=[{parameters}], CommandType='{commandType}', CommandTimeout='{commandTimeout}']{newLine}{commandText}","Properties":{"elapsed":"16","parameters":"","commandType":"Text","commandTimeout":30,"newLine":"\r\n","commandText":"DECLARE @UserId          UNIQUEIDENTIFIER\r\nDECLARE @OpinionsPerBeer INT\r\n\r\n-- Number of opinions generating for beer\r\nSET @OpinionsPerBeer = 20\r\n\r\n-- Select Id for \"user@localhost\" user\r\nSELECT @UserId = Id\r\nFROM AspNetUsers\r\nWHERE Username = 'user@localhost'\r\n\r\n-- Generate @OpinionsPerBeer opinions for each beer\r\nINSERT INTO Opinions (Id, Rating, Comment, BeerId, Created, CreatedBy, LastModified, LastModifiedBy)\r\nSELECT NEWID(),\r\n       FLOOR(RAND(CHECKSUM(NEWID())) * 10) + 1,\r\n       'Sample comment',\r\n       Beers.Id,\r\n       CreatedDate,\r\n       @UserId,\r\n       CreatedDate,\r\n       @UserId\r\nFROM Beers\r\n         CROSS JOIN (SELECT TOP (@OpinionsPerBeer) DATEADD(DAY, ABS(CHECKSUM(NEWID())) %\r\n                                                                (DATEDIFF(DAY, '2020-01-01', '2023-12-31') + 1),\r\n                                                           '2020-01-01') AS CreatedDate\r\n                     FROM sys.all_columns) AS BeerOpinions\r\nORDER BY Beers.Id\r\n\r\n-- Update beers ratings\r\nUPDATE Beers\r\nSET Rating = ISNULL(Opinions.AverageRating, 0)\r\nFROM Beers\r\n         LEFT JOIN (SELECT BeerId, ROUND(AVG(CAST(Rating AS FLOAT)), 2) AS AverageRating\r\n                    FROM Opinions\r\n                    GROUP BY BeerId) AS Opinions ON Beers.Id = Opinions.BeerId","EventId":{"Id":20102,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandError"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:18:09.2102711+02:00","Level":"Error","MessageTemplate":"Seeding {TableName} failed","Properties":{"TableName":"Opinions","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:18:09.2118303+02:00","Level":"Error","MessageTemplate":"An error occurred while seeding the database. {E}","Properties":{"E":"Invalid object name 'AspNetUsers'.","ApplicationName":"Hoppy Hub"}}
{"Timestamp":"2023-09-19T16:18:09.2165607+02:00","Level":"Fatal","MessageTemplate":"Hoppy Hub terminated unexpectedly","Exception":"Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.\r\n   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)\r\n   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)\r\n   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)\r\n   at Microsoft.Data.SqlClient.SqlCommand.InternalEndExecuteNonQuery(IAsyncResult asyncResult, Boolean isInternal, String endMethod)\r\n   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryInternal(IAsyncResult asyncResult)\r\n   at Microsoft.Data.SqlClient.SqlCommand.EndExecuteNonQueryAsync(IAsyncResult asyncResult)\r\n   at System.Threading.Tasks.TaskFactory`1.FromAsyncCoreLogic(IAsyncResult iar, Func`2 endFunction, Action`1 endAction, Task`1 promise, Boolean requiresSynchronization)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedDatabaseFromSql(String tableName) in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 155\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedOpinionsAsync() in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 120\r\n   at Infrastructure.Persistence.ApplicationDbContextInitializer.SeedAsync() in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Infrastructure\\Persistence\\ApplicationDbContextInitializer.cs:line 60\r\n   at Program.<Main>$(String[] args) in D:\\Projects\\Hoppy Hub\\Services\\HoppyHub\\src\\Api\\Program.cs:line 57\r\nClientConnectionId:564a7484-d56e-4b3f-8494-dce9d7c72a7b\r\nError Number:208,State:1,Class:16","Properties":{"ApplicationName":"Hoppy Hub"}}
